% Methodology Flow Diagram
\begin{tikzpicture}[
    scale=0.65,
    transform shape,
    node distance=1cm,
    every node/.style={font=\tiny},
    startstop/.style={rectangle, rounded corners, minimum width=2.2cm, minimum height=0.7cm, text centered, draw=black, fill=red!20, text width=2.2cm},
    process/.style={rectangle, minimum width=2.2cm, minimum height=0.7cm, text centered, draw=black, fill=blue!20, text width=2.2cm},
    decision/.style={diamond, minimum width=1.8cm, minimum height=0.7cm, text centered, draw=black, fill=green!20, text width=1.8cm, aspect=2},
    data/.style={trapezium, trapezium left angle=70, trapezium right angle=110, minimum width=2.2cm, minimum height=0.7cm, text centered, draw=black, fill=yellow!20, text width=2.2cm},
    arrow/.style={thick,->,>=stealth}
]

% Row 1: Data Collection
\node (start) [startstop] {START};
\node (datacollect) [data, below of=start] {Data Collection};
\node (sources) [process, below of=datacollect, yshift=-0.5cm] {Data Sources:\\Price, Weather,\\Supply \& Fuel};

% Row 2: Preprocessing
\node (preprocess) [process, below of=sources, yshift=-0.5cm] {Data Preprocessing};
\node (quality) [process, below of=preprocess] {Quality Checks};

% Row 3: EDA
\node (eda) [process, below of=quality, yshift=-0.5cm] {Exploratory\\Data Analysis};

% Row 4: Feature Engineering Split
\node (featsplit) [decision, below of=eda, yshift=-1cm] {Feature\\Engineering};

% Row 5a: RF Feature Engineering (Left)
\node (rfeng) [process, left of=featsplit, xshift=-4cm, yshift=-2cm] {RF Feature\\Engineering};
\node (rfsel) [process, below of=rfeng] {RF Feature\\Selection};

% Row 5b: LSTM Feature Engineering (Right)
\node (lstmeng) [process, right of=featsplit, xshift=4cm, yshift=-2cm] {LSTM Feature\\Engineering};
\node (lstmsel) [process, below of=lstmeng] {LSTM Feature\\Selection};

% Row 6: Train-Test Split
\node (split) [process, below of=featsplit, yshift=-6cm] {Train-Test Split};

% Row 7: Model Training (Three branches)
\node (models) [decision, below of=split, yshift=-0.5cm] {Model\\Training};

% Row 8a: ARIMA (Left)
\node (arima) [process, left of=models, xshift=-4cm, yshift=-2cm] {ARIMA Models};

% Row 8b: LSTM (Center)
\node (lstm) [process, below of=models, yshift=-1.5cm] {LSTM Models};

% Row 8c: RF (Right)
\node (rf) [process, right of=models, xshift=4cm, yshift=-2cm] {Random Forest};

% Row 9: Evaluation
\node (eval) [process, below of=lstm, yshift=-1.5cm] {Model Evaluation};

% Row 10: Best Model Selection
\node (best) [decision, below of=eval, yshift=-0.5cm] {Best Model\\Selection};

% Row 11: AI Agent
\node (agent) [process, below of=best, yshift=-0.5cm] {AI Agent\\Integration};

% Row 12: Deployment
\node (end) [startstop, below of=agent] {END};

% Arrows - Main Flow
\draw [arrow] (start) -- (datacollect);
\draw [arrow] (datacollect) -- (sources);
\draw [arrow] (sources) -- (preprocess);
\draw [arrow] (preprocess) -- (quality);
\draw [arrow] (quality) -- (eda);
\draw [arrow] (eda) -- (featsplit);

% Arrows - RF Branch
\draw [arrow] (featsplit) -| (rfeng);
\draw [arrow] (rfeng) -- (rfsel);
\draw [arrow] (rfsel) |- (split);

% Arrows - LSTM Branch
\draw [arrow] (featsplit) -| (lstmeng);
\draw [arrow] (lstmeng) -- (lstmsel);
\draw [arrow] (lstmsel) |- (split);

% Arrows - Model Training
\draw [arrow] (split) -- (models);
\draw [arrow] (models) -| (arima);
\draw [arrow] (models) -- (lstm);
\draw [arrow] (models) -| (rf);

% Arrows - Evaluation
\draw [arrow] (arima) |- (eval);
\draw [arrow] (lstm) -- (eval);
\draw [arrow] (rf) |- (eval);

% Arrows - Final Flow
\draw [arrow] (eval) -- (best);
\draw [arrow] (best) -- (agent);
\draw [arrow] (agent) -- (end);

\end{tikzpicture}
